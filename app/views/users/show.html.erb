<% if @current_user.present?%>
    <% if @current_user.id == @user.id%>
        <h1>Your Profile</h1>
    <% else %>
        <h1><%= @user.first_name %> <%= @user.last_name %>'s Profile</h1>
    <% end %>
<% end %>

<ul>
    <% if @user.image.present?%>
        <%= image_tag @user.image, :class => 'icon' %>
    <% end %>
    <li>First Name: <%= @user.first_name %> </li>

    <% if @current_user.id == @user.id%>
        <li>Last Name: <%= @user.last_name %> </li>
        <li>Email Address: <%= @user.email %></li>
    <% end %>
</ul>


<% if @current_user.id == @user.id%> <!-- only the user who created the trip can edit -->
    <button> <%= link_to 'Edit Profile', edit_user_path %></button>
    
    <% if @user.trips.present? %>
        <h1>Driver Trips & Bookings</h1>
            <h2>Upcoming Trips</h2>
                <% @user.trips.order(:date, :time).each do |trip| %> <!-- ordered by date then time -->
                    <% unless trip.date < Time.now %> <!-- this includes date and time -->
                        <%= link_to trip, :class => "button" do%>
                            <div class="trip-index"> 
                                <h3><%= trip.title %> - <%= trip.date.strftime '%A, %B %e' %> at <%= trip.time.strftime '%l:%M %p' %> <% if trip.bookings.count == trip.seat%> - FULLY BOOKED <% end %> </h3>
                                <%= image_tag(trip.image, :class => 'thumb') %>
                                <ul>
                                    <li>Passengers: <%= trip.bookings.count %> </li>
                                    <li>Price: <%= number_to_currency trip.price, precision: 0 %></li>
                                    <li>Car: <%= trip.car_make %> <%= trip.car_model %></li>
                                    
                                </ul>
                            </div>
                        <% end%>
                    <% end%>
                <% end%>

            <h2>Upcoming Bookings</h2>
                <% @user.trips.order(:date, :time).each do |trip| %>
                    <% unless trip.date < Time.now %>
                        <% trip.bookings.each do |booking| %>
                            <%= link_to trip, :class => "button" do%>
                                <div class="bookings">
                                    <h3 class="show-bookings"> <%= booking.trip.title %> - <%= booking.trip.date.strftime '%A, %B %e' %> at <%= booking.trip.time.strftime '%l:%M %p' %> </h3>
                                    <%= booking.user.first_name %> 
                                </div>
                            <% end%>
                        <% end%>
                    <% end %>
                <% end%>
        



            <h2>Completed Trips</h2>
                <% @user.trips.each do |trip| %>
                    <% unless trip.date > Time.now %> <!-- this includes date and time -->
                        <%= link_to trip, :class => "button" do%> 
                            <div class="trip-index"> 
                                <h3><%= trip.title %> - <%= trip.date.strftime '%A, %B %e' %> at <%= trip.time.strftime '%l:%M %p' %> <% if trip.bookings.count == trip.seat%> - FULLY BOOKED <% end %> </h3> 
                                <%= image_tag(trip.image, :class => 'thumb') %>
                                <ul>
                                    <li>Passengers: <%= trip.bookings.count %>  </li>
                                    <li>Price: <%= number_to_currency trip.price, precision: 0 %></li>
                                    <li>Car: <%= trip.car_make %> <%= trip.car_model %></li>
                                </ul>
                            </div>
                        <% end%>
                    <% end%>
                <% end %>

                <h2>Completed Bookings</h2>
                    <% @user.trips.each do |trip| %>
                        <% unless trip.date > Time.now %>
                            <% trip.bookings.each do |booking| %>
                                <%= link_to trip, :class => "button" do%>
                                    <div class="bookings">
                                        <h3 class="show-bookings"> <%= booking.trip.title %> - <%= booking.trip.date.strftime '%A, %B %e' %> at <%= booking.trip.time.strftime '%l:%M %p' %> </h3>
                                        <%= booking.user.first_name %> 
                                    </div>
                                <% end%>
                            <% end%>
                        <% end %>
                <% end %>
    <% end %>
<% end %>


