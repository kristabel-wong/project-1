
<h1>Find a Trip</h1>


<% @trips.each do |trip| %>
    <%= link_to trip_path(trip), :class => "button" do %>
    <div class="trip-index">
        <h2 class="index"><%= trip.origin %> to <%= trip.destination %></h2> 

        <h3>Leaving: <%= trip.date.strftime '%A, %B %e' %> at <%= trip.time.strftime '%l:%M %p' %>  <% if trip.seat == trip.bookings.count %> <% end %> </h3>

            <div class="trip-container">
                
                <div class="trip-user-details">
                    <% if trip.user.image.present? %>
                        <%= cl_image_tag(trip.user.image, :transformation=>[
                            {:aspect_ratio=>"1.0", :gravity=>"face", :width=>128, :zoom=>0.7, :background =>"#DBE9EF", :crop=>"thumb"},
                            {:radius=>"max"}]) %>
                    <% else %>
                        <%= cl_image_tag('cpbz8sbbm0gujijrcrvw', :class => 'trip-icon', :transformation=>[
                            {:overlay=>{:font_family=>"Hind", :font_size=>23, :font_weight=>"bold", :text=>"DEFAULT ICON"}, :color=>"#fff"},{:angle=>0, :flags=>"layer_apply", :x=>-5, :y=>62}])%>
                    <% end %>
                    <h3> <%= trip.user.first_name %> </h3>
                </div>

                <div class="trip-index-info">
                    <ul>
                        <li>Car: <%= trip.car_make %> <%= trip.car_model %></li>
                        <li>Spots booked:  </li>
                    </ul>

                    <div class="trip-bookings-icons">
                        <% trip.bookings.each do |booking| %>
                            <% if booking.user.image.present? %>
                                <%= cl_image_tag(booking.user.image, :transformation=>[
                                    {:aspect_ratio=>"1.0", :gravity=>"face", :width=>50, :zoom=>0.7, :background =>"#DBE9EF", :crop=>"thumb"},
                                    {:radius=>"max"}]) %>
                            <% else %>
                                <%= cl_image_tag('cpbz8sbbm0gujijrcrvw', :class => 'trip-icon', :transformation=>[
                                    {:overlay=>{:font_family=>"Hind", :font_size=>23, :font_weight=>"bold", :text=>"DEFAULT ICON"}, :color=>"#fff"},{:angle=>0, :flags=>"layer_apply", :x=>-5, :y=>62}])%>
                            <% end %>
                        <% end %>

                        <% (trip.seat - trip.bookings.count).times do  %>
                            <%= cl_image_tag('hujlldl6wpl8twbidml6', :class => 'trip-seat-icon') %>
                    <% end %>
                    </div>
                </div>

                <div class="trip-price">
                    <h1><%= number_to_currency trip.price, precision: 0 %></h1>
                    <h3> <% if trip.seat - trip.bookings.count == 0 %> 
                        <span> FULLY BOOKED </span>
                        <% elsif trip.seat - trip.bookings.count == 1 %>
                            <span class="red"><%= pluralize(trip.seat - trip.bookings.count, "seat") %> left! </span>
                        <% else %>
                            <%= pluralize(trip.seat - trip.bookings.count, "seat") %> left!
                        <% end %>    
                    </h3>
                </div>

                <div class="car-image">
                    <% if trip.image.present? %>
                        <%= cl_image_tag trip.image, :class => 'thumb' %>
                    <% else %>
                        <%= cl_image_tag('zpwkdm3rxbqpz3ljtd0a', :width=>275, :height=>115, :crop=>"fill", :transformation=>[
                            {:overlay=>{:font_family=>"Hind", :font_size=>30, :font_weight=>"bold", :text=>"DEFAULT ICON"}, :color=>"#000"},{:angle=>0, :flags=>"layer_apply", :x=>-5, :y=>95}
                        ]) %>
                    <% end %>
                </div>

            </div>
    </div>
    <% end %>

<% end %>
